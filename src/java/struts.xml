<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE struts PUBLIC
	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"
	"http://struts.apache.org/dtds/struts-2.3.dtd">

<struts>
    <include file="struts-notification.xml" />
    <constant name="struts.i18n.reload" value="false" />
    <constant name="struts.devMode" value="false" />
    <constant name="struts.objectFactory" value="spring" />
    <constant name="struts.multipart.saveDir" value="/tmp"></constant>
    
    <package name="default" extends="struts-default">
         <!-- this tells the package what to do when the result is an expected string.  @see RequestServerAuthenticationFilter.java && AnnotationAction.java &&DownTimeOverride.java -->
         <!-- Only put handlers here that need to apply to ALL PACKAGES -->
         <interceptors>
            <interceptor name="downTimeOverride" class="edu.slu.filter.DownTimeOverride"></interceptor>
         </interceptors>
         
        <global-results>
            <result name="403">/403.jsp</result>
            <result name="503">/down.html</result>
        </global-results>
        
    </package>
    
    <!-- This package is open to public -->
    <package name="getObject" extends="default" namespace="/id">
        <!-- INTERCEPTOR -->
        <interceptors>
            <interceptor-stack name="myDefault">
                <interceptor-ref name="downTimeOverride" />
                <interceptor-ref name="defaultStack" />
            </interceptor-stack>
        </interceptors>
        <default-interceptor-ref name="myDefault" />
        <action name="getByID" class="ObjectAction" method="getByID"></action>
    </package>
    
    <!-- This package is open to public -->
    <package name="getAncestors" extends="default" namespace="/history">
        <!-- INTERCEPTOR -->
        <interceptors>
            <interceptor-stack name="myDefault">
                <interceptor-ref name="downTimeOverride" />
                <interceptor-ref name="defaultStack" />
            </interceptor-stack>
        </interceptors>
        <default-interceptor-ref name="myDefault" />
        <action name="getAllAncestors" class="ObjectAction" method="getAllAncestors"></action>
    </package>
    
    <!-- This package is open to public -->
    <package name="getDescendants" extends="default" namespace="/since">
        <!-- INTERCEPTOR -->
        <interceptors>
            <interceptor-stack name="myDefault">
                <interceptor-ref name="downTimeOverride" />
                <interceptor-ref name="defaultStack" />
            </interceptor-stack>
        </interceptors>
        <default-interceptor-ref name="myDefault" />
        <action name="getAllDescendants" class="ObjectAction" method="getAllDescendants"></action>
    </package>
    
    <!-- OBJECTS -->
    <package name="v1" extends="default" namespace="/api">
        <!-- INTERCEPTOR -->
        <interceptors>
            <interceptor name="getRequestClientInfoRecorder" class="edu.slu.filter.GetRequestClientInfoRecorder">
            <param name="includeMethods">askAuth0, getByProperties, getByID, getAllAncestors, getAllDescendants, getAllVersions</param>
            </interceptor>
            <interceptor-stack name="myDefault">
                <interceptor-ref name="downTimeOverride" />
                <interceptor-ref name="getRequestClientInfoRecorder" />
                <interceptor-ref name="defaultStack" />
            </interceptor-stack>
        </interceptors>
        <default-interceptor-ref name="myDefault" />
        
        <!-- TPEN_NL support -->
        <action name="getByProperties" class="ObjectAction" method="getByProperties"></action>
        <action name="getByID" class="ObjectAction" method="getByID"></action>
        <action name="getAllAncestors" class="ObjectAction" method="getAllAncestors"></action>
        <action name="getAllDescendants" class="ObjectAction" method="getAllDescendants"></action>
        <action name="create" class="ObjectAction" method="saveNewObject"></action>
        <!-- TPEN_NL support -->
        <action name="batch_create" class="ObjectAction" method="batchSaveFromCopy"></action>
        <action name="release" class="ObjectAction" method="releaseObject"></action>
        <action name="patch" class="ObjectAction" method="patchUpdateObject"></action>
        <action name="update" class="ObjectAction" method="putUpdateObject"></action>
        <action name="overwrite" class="ObjectAction" method="overwriteObject"></action>
        <action name="set" class="ObjectAction" method="patchSetUpdate"></action>
        <action name="unset" class="ObjectAction" method="patchUnsetUpdate"></action>
        <action name="delete" class="ObjectAction" method="deleteObject"></action>
        <action name="ask" class="ObjectAction" method="askAuth0"></action>
        <action name="refreshToken" class="ObjectAction" method="generateNewRefreshToken"></action>
        <action name="accessToken" class="ObjectAction" method="generateNewAccessToken"></action>
    </package>
    
    <!-- ACCEPTED SERVER -->
    <package name="acceptedServer" extends="default" namespace="/acceptedServer">
        <!-- INTERCEPTOR -->
        <interceptors>
            <interceptor-stack name="myDefault">
                <interceptor-ref name="downTimeOverride" />
                <interceptor-ref name="defaultStack" />
            </interceptor-stack>
        </interceptors>
        <default-interceptor-ref name="myDefault" />
        <action name="saveNewServer" class="serverAction" method="saveNewServer"></action>
        <action name="updateServerByObjectID" class="serverAction" method="updateServerByObjectID"></action>
        <action name="getServerByIp" class="serverAction" method="getServerByIp"></action>
    </package>
    
</struts>

